{% extends '@pages/base.html.twig' %}

{% block head %}

    {{ parent() }}

    {% block head_jquery %}
        <style>
            .grafico {
                width: 100%;
                height: 500px;
            }
        </style>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.33/vfs_fonts.js"></script>
        <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
        <script src="https://www.amcharts.com/lib/3/pie.js"></script>
        <script src="https://www.amcharts.com/lib/3/serial.js"></script>
        <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
        <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
        <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    {% endblock %}

{% endblock %}

{% block body_content %}
    {{ parent() }}

    {#{% set instance = body.content.instance %}#}
    {% set dados = body.content.dados %}
    {% set cabecalho = body.content.dados.cabecalho %}
    {% set linhas = body.content.dados.linhas %}

    <div class="g-block size-100 w-clearfix">
        <div id="grafico_sexo" class="grafico"></div>
        <div id="grafico_idade" class="grafico"></div>
        <div id="grafico_escolaridade" class="grafico"></div>
    </div>


    <script>
        var chart = AmCharts.makeChart( "grafico_sexo", {
            "type": "pie",
            "theme": "light",
            "dataProvider": [
                {
                    "label": "{{ cabecalho[0] }}",
                    "ammount": "{{ linhas[0][0] }}"
                },
                {
                    "label": "{{ cabecalho[1] }}",
                    "ammount": "{{ linhas[0][1] }}"
                },
            ],
            "valueField": "ammount",
            "titleField": "label",
            "outlineAlpha": 0.4,
            "depth3D": 15,
            "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[ammount]]</b> ([[percents]]%)</span>",
            "angle": 30,
            "export": {
                "enabled": true
            }
        });

        var chart = AmCharts.makeChart( "grafico_idade", {
            "type": "serial",
            "theme": "light",
            "dataProvider": [
                {% for item in linhas[0][2] %}
                    {
                        "country": "{{ item.idade }}",
                        "visits": "{{ item.count }}"
                    },
                {% endfor %}
            ],
            "startDuration": 1,
            "graphs": [{
                "balloonText": "<b>[[category]] anos: [[value]]</b>",
                "fillColorsField": "color",
                "fillAlphas": 0.9,
                "lineAlpha": 0.2,
                "type": "column",
                "valueField": "visits"
            }],
            "chartCursor": {
                "categoryBalloonEnabled": false,
                "cursorAlpha": 0,
                "zoomable": false
            },
            "categoryField": "country",
            "categoryAxis": {
                "gridPosition": "start",
                "labelRotation": 45
            },
            "export": {
                "enabled": true
            }
        } );

        var chart = AmCharts.makeChart( "grafico_escolaridade", {
            "type": "pie",
            "theme": "light",
            "dataProvider": [
                {% for key, value in linhas[0][3] %}
                    {
                        "label": "{{ key }}",
                        "ammount": "{{ value }}"
                    },
                {% endfor %}
            ],
            "valueField": "ammount",
            "titleField": "label",
            "outlineAlpha": 0.4,
            "depth3D": 15,
            "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[ammount]]</b> ([[percents]]%)</span>",
            "angle": 30,
            "export": {
                "enabled": true
            }
        });
    </script>

    {{ dados.botoes|raw }}
{% endblock %}
